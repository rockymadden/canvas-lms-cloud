---

- name: install apache related packages
  apt: pkg={{ item }} state=latest update_cache=yes cache_valid_time=3600
  with_items:
     - apache2
     - libapache2-mod-passenger
  when: jobs_only is not defined or not jobs_only|bool
  tags:
    - apache
    - install

- name: enable apache rewrite mod
  command: a2enmod rewrite creates=/etc/apache2/mods-enabled/rewrite.load
  notify: restart apache service
  when: jobs_only is not defined or not jobs_only|bool
  tags:
    - apache
    - configure

- name: enable apache passenger mod
  command: a2enmod passenger creates=/etc/apache2/mods-enabled/passenger.load
  notify: restart apache service
  when: jobs_only is not defined or not jobs_only|bool
  tags:
    - apache
    - configure

- name: remove default apache sites
  file: path={{ item }} state=absent
  with_items:
    - /etc/apache2/sites-enabled/000-default.conf
    - /etc/apache2/sites-available/000-default.conf
    - /etc/apache2/sites-available/default-ssl.conf
  notify: restart apache service
  when: jobs_only is not defined or not jobs_only|bool
  tags:
    - apache
    - configure

- name: configure canvas apache site
  template: src=etc/apache2/sites-available/canvas.conf.j2 dest=/etc/apache2/sites-available/canvas.conf
  notify: restart apache service
  tags:
    - apache
    - configure

- name: enable canvas apache site
  command: a2ensite canvas.conf
  notify: restart apache service
  tags:
    - apache
    - configure
